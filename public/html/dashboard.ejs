<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GTPSID Login</title>
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    /* ========== STYLING (TETAP SAMA) ========== */
    :root {
      --primary-grad: linear-gradient(to right, #FF4B2B, #FF416C);
      --overlay-grad: linear-gradient(to right, #FF416C, #FF4B2B);
      --bg-grad: linear-gradient(135deg, #FFDEE9 0%, #B5FFFC 100%);
      --white: #ffffff;
      --gray: #333;
      --input-bg: #eee;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      height: 100vh;
      background: var(--bg-grad);
      overflow: hidden;
    }

    .container {
      background-color: var(--white);
      border-radius: 20px;
      box-shadow: 0 14px 28px rgba(0, 0, 0, 0.25), 
                  0 10px 10px rgba(0, 0, 0, 0.22);
      position: relative;
      overflow: hidden;
      width: 850px;
      max-width: 100%;
      min-height: 550px;
    }

    .form-container {
      position: absolute;
      top: 0;
      height: 100%;
      transition: all 0.6s ease-in-out;
    }

    form {
      background-color: var(--white);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      padding: 0 50px;
      height: 100%;
      text-align: center;
    }

    h1 {
      font-weight: 700;
      margin-bottom: 20px;
      color: var(--gray);
    }

    span {
      font-size: 12px;
      color: #888;
      margin-bottom: 20px;
      display: block;
    }

    .input-group {
      position: relative;
      width: 100%;
      margin: 8px 0;
    }

    input {
      background-color: var(--input-bg);
      border: 1px solid transparent;
      padding: 12px 15px 12px 45px;
      width: 100%;
      border-radius: 8px;
      outline: none;
      font-size: 14px;
      transition: all 0.3s;
    }

    input:focus {
      background-color: #fff;
      border-color: #FF4B2B;
      box-shadow: 0 0 10px rgba(255, 75, 43, 0.1);
    }

    .input-group i {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #888;
      font-size: 18px;
      z-index: 1;
    }

    .autocomplete-list {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border: 1px solid #ddd;
      border-top: none;
      border-radius: 0 0 8px 8px;
      z-index: 10;
      max-height: 150px;
      overflow-y: auto;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-align: left;
    }
    .autocomplete-list li {
      padding: 10px 15px;
      cursor: pointer;
      font-size: 13px;
      color: #333;
    }
    .autocomplete-list li:hover {
      background-color: #f1f1f1;
      color: #FF4B2B;
    }

    button {
      border-radius: 20px;
      border: 1px solid #FF4B2B;
      background: var(--primary-grad);
      color: #FFFFFF;
      font-size: 12px;
      font-weight: bold;
      padding: 12px 45px;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: transform 80ms ease-in;
      cursor: pointer;
      margin-top: 25px;
      box-shadow: 0 5px 15px rgba(255, 75, 43, 0.3);
    }
    
    button.loading {
        cursor: not-allowed;
        opacity: 0.8;
        background: gray;
    }

    button:active { transform: scale(0.95); }
    button:focus { outline: none; }
    button.ghost {
      background: transparent;
      border-color: #FFFFFF;
      box-shadow: none;
    }

    .server-response {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        border-radius: 8px;
        font-size: 13px;
        text-align: center;
        display: none;
    }
    .server-response.show { display: block; }
    .server-response.success { background: #e6ffed; color: #00701a; border: 1px solid #00701a; }
    .server-response.error { background: #ffe6e6; color: #cc0000; border: 1px solid #cc0000; }


    .error-message {
      color: #ff4444;
      font-size: 11px;
      text-align: left;
      width: 100%;
      padding-left: 10px;
      height: 0;
      overflow: hidden;
      transition: 0.3s;
    }
    .error-message.show { height: auto; margin-top: 5px; }

    /* ========== LOGIKA ANIMASI GESER (SAMA) ========== */
    .sign-in-container { left: 0; width: 50%; z-index: 2; }
    .sign-up-container { left: 0; width: 50%; opacity: 0; z-index: 1; }
    .container.right-panel-active .sign-in-container { transform: translateX(100%); }
    .container.right-panel-active .sign-up-container { transform: translateX(100%); opacity: 1; z-index: 5; animation: show 0.6s; }
    @keyframes show { 0%, 49.99% { opacity: 0; z-index: 1; } 50%, 100% { opacity: 1; z-index: 5; } }
    .overlay-container { position: absolute; top: 0; left: 50%; width: 50%; height: 100%; overflow: hidden; transition: transform 0.6s ease-in-out; z-index: 100; }
    .container.right-panel-active .overlay-container { transform: translateX(-100%); }
    .overlay { background: var(--overlay-grad); background-repeat: no-repeat; background-size: cover; background-position: 0 0; color: #FFFFFF; position: relative; left: -100%; height: 100%; width: 200%; transform: translateX(0); transition: transform 0.6s ease-in-out; }
    .container.right-panel-active .overlay { transform: translateX(50%); }
    .overlay-panel { position: absolute; display: flex; align-items: center; justify-content: center; flex-direction: column; padding: 0 40px; text-align: center; top: 0; height: 100%; width: 50%; transform: translateX(0); transition: transform 0.6s ease-in-out; }
    .overlay-left { transform: translateX(-20%); }
    .container.right-panel-active .overlay-left { transform: translateX(0); }
    .overlay-right { right: 0; transform: translateX(0); }
    .container.right-panel-active .overlay-right { transform: translateX(20%); }

    /* Mobile Styles */
    .mobile-toggle { display: none; margin-top: 15px; color: #FF4B2B; font-weight: bold; font-size: 13px; cursor: pointer; }
    @media (max-width: 768px) {
        .container { width: 100%; min-height: 100vh; border-radius: 0; box-shadow: none; }
        .form-container { width: 100%; }
        .overlay-container { display: none; }
        .sign-in-container { z-index: 2; }
        .sign-up-container { z-index: 1; opacity: 0; }
        .container.right-panel-active .sign-in-container { opacity: 0; pointer-events: none; }
        .container.right-panel-active .sign-up-container { opacity: 1; pointer-events: all; transform: none; animation: none; }
        .mobile-toggle { display: block; }
    }
  </style>
</head>

<body>

  <div class="container" id="container">
    
    <div class="form-container sign-up-container">
      <form method="post" action="/player/growid/login/validate" id="regisForm" autocomplete="off">
        <h1>Create Account</h1>
        <span>Lengkapi data berikut untuk membuat akun baru</span>
        
        <input name="action" value="register" type="hidden" />
        
        <div class="server-response" id="regisServerResponse"></div>

        <div class="input-group">
          <i class='bx bxs-server'></i>
          <input type="text" name="_token" id="regisServerInput" placeholder="Server Name (e.g. STYLOPS)" required />
          <div class="error-message" id="regisServerError"></div>
        </div>

        <div class="input-group">
          <i class='bx bxs-user'></i>
          <input type="text" name="growId" id="regisGrowId" placeholder="GrowID" required />
          <div class="error-message" id="regisUsernameError"></div>
        </div>

        <div class="input-group">
          <i class='bx bxs-lock-alt'></i>
          <input type="password" name="password" id="regisPassword" placeholder="Password" required />
          <div class="error-message" id="regisPasswordError"></div>
        </div>

        <div class="input-group">
            <i class='bx bxs-lock-open-alt'></i>
            <input type="password" name="confirmPassword" id="regisConfirmPassword" placeholder="Confirm Password" required />
            <div class="error-message" id="regisConfirmError"></div>
          </div>

        <button type="submit" id="regisButton">Sign Up</button>
        <div class="mobile-toggle" id="mobileToLogin">Already have an account? Sign In</div>
      </form>
    </div>

    <div class="form-container sign-in-container">
      <form method="post" action="/player/growid/login/validate" id="loginForm" autocomplete="off">
        <h1>Sign in</h1>
        <span>Masuk menggunakan akun kamu</span>

        <div class="server-response" id="loginServerResponse"></div>

        <div class="input-group">
            <i class='bx bxs-server'></i>
            <input type="text" name="_token" id="loginServerInput" placeholder="Server Name" required />
            <div class="error-message" id="loginServerError"></div>
        </div>

        <div class="input-group">
          <i class='bx bxs-user'></i>
          <input type="text" name="growId" id="loginGrowId" placeholder="GrowID" required />
          <div class="error-message" id="loginUsernameError"></div>
        </div>

        <div class="input-group">
          <i class='bx bxs-lock-alt'></i>
          <input type="password" name="password" id="loginPassword" placeholder="Password" required />
          <div class="error-message" id="loginPasswordError"></div>
        </div>

        <a href="https://eternityps.site/" style="color: #666; font-size: 12px; margin: 15px 0; text-decoration: none;">Forgot your password?</a>
        
        <button type="submit" id="loginButton">Sign In</button>
        <div class="mobile-toggle" id="mobileToRegister">Don't have an account? Sign Up</div>
      </form>
    </div>

    <div class="overlay-container">
      <div class="overlay">
        <div class="overlay-panel overlay-left">
          <h1>Welcome Back!</h1>
          <p>Jika sudah memiliki akun, silakan login di sini untuk melanjutkan permainan.</p>
          <button class="ghost" id="signIn">Sign In</button>
        </div>
        <div class="overlay-panel overlay-right">
          <h1>Hello, Player!</h1>
          <p>Belum punya akun? Daftar sekarang dan mulai petualangan di dunia GTPS.</p>
          <button class="ghost" id="signUp">Sign Up</button>
        </div>
      </div>
    </div>

  </div>

  <script>
    const servers = ["STYLOPS", "CHINAPS", "COASTPS", "SLOWLYPS", "NEXPS", "TESPS", "IDLEPS", "ETERNITYPS"];
    const validateEndpoint = '/player/growid/login/validate'; // Target endpoint

    document.addEventListener('DOMContentLoaded', () => {
      /* --- 1. SLIDING ANIMATION & LOCAL STORAGE --- */
      const container = document.getElementById('container');
      const signUpBtn = document.getElementById('signUp');
      const signInBtn = document.getElementById('signIn');
      const mobileToReg = document.getElementById('mobileToRegister');
      const mobileToLog = document.getElementById('mobileToLogin');

      const goToRegister = () => {
        container.classList.add("right-panel-active");
        resetFormUI('loginForm');
      };

      const goToLogin = () => {
        container.classList.remove("right-panel-active");
        resetFormUI('regisForm');
      };

      signUpBtn.addEventListener('click', goToRegister);
      signInBtn.addEventListener('click', goToLogin);
      mobileToReg.addEventListener('click', goToRegister);
      mobileToLog.addEventListener('click', goToLogin);

      if (localStorage.getItem('growId')) {
        const savedId = localStorage.getItem('growId');
        document.getElementById('loginGrowId').value = savedId;
        document.getElementById('regisGrowId').value = savedId;
      }
      if (localStorage.getItem('lastServer')) {
        const savedServer = localStorage.getItem('lastServer');
        document.getElementById('loginServerInput').value = savedServer;
        document.getElementById('regisServerInput').value = savedServer;
      }

      /* --- 2. AUTOCOMPLETE SERVER --- */
      function setupAutocomplete(inputId) {
        const input = document.getElementById(inputId);
        let list = null;

        input.addEventListener('input', function() {
            if(list) list.remove();
            const val = this.value.toUpperCase();
            if(!val) return;

            const matches = servers.filter(s => s.startsWith(val));
            if(!matches.length) return;

            list = document.createElement('ul');
            list.className = 'autocomplete-list';
            
            matches.forEach(m => {
                const item = document.createElement('li');
                item.textContent = m;
                item.onclick = () => {
                    input.value = m;
                    list.remove();
                    list = null;
                };
                list.appendChild(item);
            });
            input.parentNode.appendChild(list);
        });

        document.addEventListener('click', (e) => {
            if(list && !input.contains(e.target)) { list.remove(); list = null; }
        });
      }

      setupAutocomplete('loginServerInput');
      setupAutocomplete('regisServerInput');

      /* --- 3. VALIDATION & UI FUNCTIONS --- */
      const showError = (el, msg) => {
        const errorEl = document.getElementById(el);
        if(errorEl) { 
            errorEl.textContent = msg; 
            errorEl.classList.add('show'); 
        }
        return false;
      };

      const resetErrors = (formId) => {
        document.getElementById(formId).querySelectorAll('.error-message').forEach(e => e.classList.remove('show'));
      };
      
      const resetFormUI = (formId) => {
          resetErrors(formId);
          document.getElementById(formId).querySelector('.server-response').classList.remove('show', 'success', 'error');
      }

      document.querySelectorAll('input').forEach(inp => {
        inp.addEventListener('input', function() {
            const err = this.parentNode.querySelector('.error-message');
            if(err) err.classList.remove('show');
            resetFormUI(this.form.id);
        });
      });
      
      function handleServerResponse(response, responseEl) {
          responseEl.textContent = response.message || 'Unknown error occurred.';
          responseEl.classList.add('show');
          
          if (response.status === 'success') {
              responseEl.classList.add('success');
              responseEl.classList.remove('error');
              return true;
          } else {
              responseEl.classList.add('error');
              responseEl.classList.remove('success');
              return false;
          }
      }

      /* --- 4. ASYNC FORM SUBMISSION (REVISI) --- */
      
      async function submitForm(formId, buttonId) {
        const form = document.getElementById(formId);
        const btn = document.getElementById(buttonId);
        const responseEl = document.getElementById(`${formId.replace('Form', 'ServerResponse')}`);
        const isRegister = formId === 'regisForm';
        
        resetErrors(formId);
        resetFormUI(formId);
        
        let valid = true;
        
        // --- CLIENT-SIDE VALIDATION ---
        const server = form.querySelector('[name="_token"]').value.trim();
        const growId = form.querySelector('[name="growId"]').value.trim();
        const pass = form.querySelector('[name="password"]').value.trim();
        
        const serverErrorId = formId.replace('Form', 'ServerError');
        const growIdErrorId = formId.replace('Form', 'UsernameError');
        const passErrorId = formId.replace('Form', 'PasswordError');

        if (!server) valid = showError(serverErrorId, 'Nama Server harus diisi.');
        if (!growId) valid = showError(growIdErrorId, 'GrowID harus diisi.');
        if (!pass) valid = showError(passErrorId, 'Password harus diisi.');
        
        // Cek Confirm Password hanya di Register
        if (isRegister) {
            const confirm = form.querySelector('[name="confirmPassword"]').value.trim();
            if (pass !== confirm) valid = showError('regisConfirmError', 'Konfirmasi Password tidak cocok.');
        }

        if (!valid) return;
        // --- END CLIENT-SIDE VALIDATION ---
        
        btn.textContent = isRegister ? 'Registering...' : 'Signing In...';
        btn.classList.add('loading');
        
        // Prepare data for fetch
        // Menggunakan FormData untuk otomatis mengambil semua field form
        const formData = new URLSearchParams(new FormData(form)).toString();

        try {
            const response = await fetch(validateEndpoint, {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData
            });

            const text = await response.text();
            let data;
            try {
                data = JSON.parse(text);
            } catch (e) {
                console.error("Failed to parse JSON response:", text);
                data = { status: 'error', message: 'Respon server tidak valid' };
            }
            
            const isSuccess = handleServerResponse(data, responseEl);
            
            if (isSuccess) {
                localStorage.setItem('growId', growId);
                localStorage.setItem('lastServer', server);
                
                // Jika Register sukses, alihkan ke form Login
                if (isRegister) {
                    setTimeout(() => {
                        goToLogin(); // Alihkan ke halaman Login
                    }, 2000); 
                } else {
                    // Jika Login sukses, Anda bisa redirect ke dashboard
                    // setTimeout(() => window.location.href = '/player/login/dashboard', 1000);
                }
            }

        } catch (error) {
            console.error('Fetch error:', error);
            handleServerResponse({ status: 'error', message: 'Gagal terhubung ke server.' }, responseEl);
        } finally {
            btn.textContent = isRegister ? 'Sign Up' : 'Sign In';
            btn.classList.remove('loading');
        }
      }


      // Event Listeners
      const loginForm = document.getElementById('loginForm');
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        submitForm('loginForm', 'loginButton');
      });

      const regisForm = document.getElementById('regisForm');
      regisForm.addEventListener('submit', (e) => {
        e.preventDefault();
        submitForm('regisForm', 'regisButton');
      });

    });
  </script>
</body>
</html>
